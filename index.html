<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Event Profit Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f6f8; }
    h1, h2 { margin-bottom: 10px; }
    fieldset { border: 1px solid #ccc; margin-bottom: 20px; padding: 15px; background: #fff; }
    legend { font-weight: bold; }
    .input-grid {
      display: grid;
      grid-template-columns: 250px 150px 250px;
      row-gap: 10px;
      column-gap: 10px;
      align-items: center;
    }
    input[type="number"], input[type="range"] {
      width: 100%;
      padding: 5px;
      box-sizing: border-box;
    }
    .summary {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-top: 20px;
    }
    .card {
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      text-align: center;
    }
    .income { color: green; }
    .cost { color: red; }
    .profit-positive { color: green; font-weight: bold; }
    .profit-negative { color: red; font-weight: bold; }

    table { 
      width: 100%; 
      border-collapse: collapse; 
      margin-top: 20px; 
      background: #fff; 
      display: block;
      overflow-x: auto;
      white-space: nowrap;
    }
    th, td { 
      border: 1px solid #ccc; 
      padding: 8px 10px; 
      text-align: center; 
    }
    th { 
      background: #dee2e6; 
      position: sticky; 
      top: 0; 
      z-index: 1; 
    }
    td { vertical-align: top; }
    td small { display: block; font-size: 0.8em; color: #555; }

    th:nth-child(1), td:nth-child(1) { min-width: 100px; text-align: left; }
    th:nth-child(2), td:nth-child(2) { min-width: 80px; }
    th:nth-child(3), td:nth-child(3) { min-width: 80px; }
    th:nth-child(4), td:nth-child(4) { min-width: 110px; }
    th:nth-child(5), td:nth-child(5) { min-width: 120px; }
    th:nth-child(6), td:nth-child(6) { min-width: 140px; }
    th:nth-child(7), td:nth-child(7) { min-width: 140px; }
    th:nth-child(8), td:nth-child(8) { min-width: 140px; }
    th:nth-child(9), td:nth-child(9) { min-width: 140px; }
    th:nth-child(10), td:nth-child(10) { min-width: 160px; }
    th:nth-child(11), td:nth-child(11) { min-width: 130px; }
    th:nth-child(12), td:nth-child(12) { min-width: 140px; }
    th:nth-child(13), td:nth-child(13) { min-width: 120px; }
    th:nth-child(14), td:nth-child(14) { min-width: 120px; }
    th:nth-child(15), td:nth-child(15) { min-width: 140px; }
    th:nth-child(16), td:nth-child(16) { min-width: 150px; }
    th:nth-child(17), td:nth-child(17) { min-width: 140px; }
    th:nth-child(18), td:nth-child(18) { min-width: 140px; }
    th:nth-child(19), td:nth-child(19) { min-width: 140px; }
  </style>
</head>
<body>
  <h1>Event Profit Calculator</h1>

  <fieldset>
    <legend>Fixed Costs</legend>
    <div class="input-grid">
      <label>Venue Hire (£):</label> 
      <input type="number" id="venueHire" value="300" min="0"><span></span>

      <label>Comedian (£):</label> 
      <input type="number" id="comedian" value="350" min="0"><span></span>
    </div>
  </fieldset>

  <fieldset>
    <legend>Variable Costs</legend>
    <div class="input-grid">
      <label>Base Attendance:</label> 
      <input type="number" id="attendanceInput" value="127" min="0"><span></span>

      <label>Masonic %:</label> 
      <input type="range" id="masonicPercent" value="50" min="0" max="100" oninput="updateCalculations()">
      <span>
        <span id="masonicLabel">50%</span> 
        (<span id="masonicGuests">0</span> M, <span id="nonMasonicGuests">0</span> NM)
      </span>

      <label>Wine Bottles (used):</label> 
      <input type="number" id="wineBottlesInput" value="90" min="0"><span></span>

      <label>Complimentary Masonic Tickets:</label> 
      <input type="number" id="compMasonic" value="6" min="0"><span></span>

      <label>Complimentary Non-Masonic Tickets:</label> 
      <input type="number" id="compNonMasonic" value="4" min="0"><span></span>

      <label>Charity Contribution (£):</label> 
      <input type="number" id="charityInput" value="0" min="0"><span></span>
    </div>
  </fieldset>

  <fieldset>
    <legend>Projected Income</legend>
    <div class="input-grid">
      <label>Raffle Income (£): <small>£5 per ticket strip</small></label> 
      <input type="number" id="raffleIncome" value="820" min="0"><span></span>

      <label>Fish Race Income (£): <small>£5 per ticket</small></label> 
      <input type="number" id="fishRaceIncome" value="895" min="0"><span></span>

      <label>Bottle Comp Income (£): <small>£1 per go</small></label> 
      <input type="number" id="bottleCompIncome" value="140" min="0"><span></span>

      <label>Card Transactions (%):</label>
      <input type="range" id="cardTransactions" value="40" min="0" max="100" oninput="updateCalculations()">
      <span id="cardLabel">40%</span>
    </div>
  </fieldset>

  <h2>Summary</h2>
  <div class="summary">
    <div class="card">Attendance: <span id="summaryAttendance"></span></div>
    <div class="card">Wine Bottles: <span id="summaryBottles"></span></div>
    <div class="card">Wine Cost: <span id="summaryWineCost"></span></div>
    <div class="card income">Gross Revenue: <span id="summaryGrossRevenue"></span></div>
    <div class="card cost">Card Fees: <span id="summaryCardFees"></span></div>
    <div class="card income">Net Revenue: <span id="summaryNetRevenue"></span></div>
    <div class="card profit-positive">Best Case: <span id="bestScenario"></span></div>
    <div class="card profit-negative">Worst Case: <span id="worstScenario"></span></div>
  </div>

  <h2>Scenarios</h2>
  <table>
    <thead>
      <tr>
        <th>Scenario</th>
        <th>Attendance</th>
        <th>Masonic %</th>
        <th>Non-Masonic %</th>
        <th>Prices</th>
        <th>Ticket Revenue</th>
        <th>Raffle</th>
        <th>Fish Race</th>
        <th>Bottle Comp</th>
        <th>Gross Revenue</th>
        <th>Card Fees</th>
        <th>Net Revenue</th>
        <th>Meals</th>
        <th>Wine</th>
        <th>Fixed Costs</th>
        <th>Variable Costs</th>
        <th>Gross Profit</th>
        <th>Total Costs</th>
        <th>Net Profit</th>
      </tr>
    </thead>
    <tbody id="scenariosTableBody"></tbody>
  </table>

  <script>
    function formatCurrency(value) {
      return (value < 0 ? "("+new Intl.NumberFormat('en-GB',{style:'currency',currency:'GBP'}).format(Math.abs(value))+")" 
                        : new Intl.NumberFormat('en-GB',{style:'currency',currency:'GBP'}).format(value));
    }
    function formatProfit(value) {
      return value >= 0 ? '+'+formatCurrency(value) : formatCurrency(value);
    }
    function getProfitClass(value) {
      return value >= 0 ? 'profit-positive' : 'profit-negative';
    }

    function getInputValues() {
      return {
        venueHire: parseFloat(document.getElementById('venueHire').value)||0,
        comedian: parseFloat(document.getElementById('comedian').value)||0,
        baseAttendance: parseInt(document.getElementById('attendanceInput').value)||0,
        masonicPercent: parseInt(document.getElementById('masonicPercent').value)||0,
        nonMasonicPercent: 100-(parseInt(document.getElementById('masonicPercent').value)||0),
        wineBottles: parseInt(document.getElementById('wineBottlesInput').value)||0,
        compMasonic: parseInt(document.getElementById('compMasonic').value)||0,
        compNonMasonic: parseInt(document.getElementById('compNonMasonic').value)||0,
        charityContribution: parseFloat(document.getElementById('charityInput').value)||0,
        raffleIncome: parseFloat(document.getElementById('raffleIncome').value)||0,
        fishRaceIncome: parseFloat(document.getElementById('fishRaceIncome').value)||0,
        bottleCompIncome: parseFloat(document.getElementById('bottleCompIncome').value)||0,
        cardPercent: parseInt(document.getElementById('cardTransactions').value)||0,
        mealCostPerGuest: 32,
        winePerBottle: 19.5
      };
    }

    function calculateScenario(groupName, prices, inputValues) {
      const attendance = inputValues.baseAttendance;
      const masonicGuests = Math.round(attendance * inputValues.masonicPercent / 100);
      const nonMasonicGuests = attendance - masonicGuests;
      const paidMasonic = Math.max(masonicGuests - inputValues.compMasonic,0);
      const paidNonMasonic = Math.max(nonMasonicGuests - inputValues.compNonMasonic,0);

      const ticketRevenue = (paidMasonic * prices.masonic) + (paidNonMasonic * prices.nonMasonic);
      const sideIncome = inputValues.raffleIncome + inputValues.fishRaceIncome + inputValues.bottleCompIncome;
      const grossRevenue = ticketRevenue + sideIncome;

      const totalTickets = paidMasonic + paidNonMasonic;
      const avgTicketPrice = totalTickets>0 ? ticketRevenue/totalTickets : 0;
      const cardFeePerTicket = (avgTicketPrice*0.015)+0.20;
      const totalCardFees = (totalTickets*(inputValues.cardPercent/100))*cardFeePerTicket;
      const netRevenue = grossRevenue - totalCardFees;

      const mealsCost = attendance * inputValues.mealCostPerGuest;
      const wineCost = inputValues.wineBottles * inputValues.winePerBottle;

      const fixedCosts = inputValues.venueHire + inputValues.comedian;
      const variableCosts = mealsCost + wineCost + inputValues.charityContribution;
      const totalCosts = fixedCosts + variableCosts;

      const grossProfit = netRevenue - mealsCost - wineCost;
      const netProfit = netRevenue - totalCosts;

      return {
        name: groupName,
        attendance,
        masonicPercent: inputValues.masonicPercent,
        nonMasonicPercent: inputValues.nonMasonicPercent,
        masonicPrice: prices.masonic,
        nonMasonicPrice: prices.nonMasonic,
        ticketRevenue, sideIncome, grossRevenue, totalCardFees, netRevenue,
        mealsCost, wineCost, fixedCosts, variableCosts, grossProfit, totalCosts, netProfit
      };
    }

    function updateCalculations() {
      const inputValues = getInputValues();

      // Update Masonic % display with split
      document.getElementById('masonicLabel').textContent = inputValues.masonicPercent + '%';
      const masonicGuests = Math.round(inputValues.baseAttendance * inputValues.masonicPercent / 100);
      const nonMasonicGuests = inputValues.baseAttendance - masonicGuests;
      document.getElementById('masonicGuests').textContent = masonicGuests;
      document.getElementById('nonMasonicGuests').textContent = nonMasonicGuests;

      // Update card slider label
      document.getElementById('cardLabel').textContent = inputValues.cardPercent + '%';

      const scenarios = [
        {group:'Group 1', prices:{masonic:40, nonMasonic:35}},
        {group:'Group 2', prices:{masonic:45, nonMasonic:40}}
      ];
      const calculatedScenarios = scenarios.map(s => calculateScenario(s.group, s.prices, inputValues));

      const totalWineCost = inputValues.wineBottles * inputValues.winePerBottle;
      document.getElementById('summaryAttendance').textContent = inputValues.baseAttendance;
      document.getElementById('summaryBottles').textContent = inputValues.wineBottles;
      document.getElementById('summaryWineCost').textContent = formatCurrency(totalWineCost);

      const grossRevenue = calculatedScenarios[0].grossRevenue;
      const cardFees = calculatedScenarios[0].totalCardFees;
      const netRevenue = calculatedScenarios[0].netRevenue;
      document.getElementById('summaryGrossRevenue').textContent = formatCurrency(grossRevenue);
      document.getElementById('summaryCardFees').textContent = formatCurrency(-cardFees);
      document.getElementById('summaryNetRevenue').textContent = formatCurrency(netRevenue);

      const profits = calculatedScenarios.map(s => s.netProfit);
      document.getElementById('bestScenario').textContent = formatProfit(Math.max(...profits));
      document.getElementById('worstScenario').textContent = formatProfit(Math.min(...profits));

      const tableBody = document.getElementById('scenariosTableBody');
      tableBody.innerHTML = '';
      calculatedScenarios.forEach(scenario => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><strong>${scenario.name}</strong></td>
          <td>${scenario.attendance}</td>
          <td>${scenario.masonicPercent}%</td>
          <td>${scenario.nonMasonicPercent}%</td>
          <td><small>M: £${scenario.masonicPrice}<br>NM: £${scenario.nonMasonicPrice}</small></td>
          <td class="income">${formatCurrency(scenario.ticketRevenue)}</td>
          <td class="income">${formatCurrency(inputValues.raffleIncome)}</td>
          <td class="income">${formatCurrency(inputValues.fishRaceIncome)}</td>
          <td class="income">${formatCurrency(inputValues.bottleCompIncome)}</td>
          <td class="income">${formatCurrency(scenario.grossRevenue)}</td>
          <td class="cost">(${formatCurrency(scenario.totalCardFees)})</td>
          <td class="income">${formatCurrency(scenario.netRevenue)}</td>
          <td class="cost">(${formatCurrency(scenario.mealsCost)})</td>
          <td class="cost">(${formatCurrency(scenario.wineCost)})</td>
          <td class="cost">(${formatCurrency(scenario.fixedCosts)})</td>
          <td class="cost">(${formatCurrency(scenario.variableCosts)})</td>
          <td class="${getProfitClass(scenario.grossProfit)}">${formatProfit(scenario.grossProfit)}</td>
          <td class="cost">(${formatCurrency(scenario.totalCosts)})</td>
          <td class="${getProfitClass(scenario.netProfit)}">${formatProfit(scenario.netProfit)}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    document.querySelectorAll('input').forEach(el => el.addEventListener('input', updateCalculations));
    updateCalculations();
  </script>
</body>
</html>
